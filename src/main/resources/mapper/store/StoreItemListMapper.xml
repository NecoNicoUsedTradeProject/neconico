<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.neconico.neconico.mapper.store.StoreItemListMapper">
    <resultMap id="itemcard" type="itemcardvo">
        <id column="itemid" property="itemId"/>
        <result column="title" property="title"/>
        <result column="price" property="price"/>
        <result column="img" property="itemImg"/>
        <result column="created" property="createdTime"/>
        <result column="status" property="status"/>
    </resultMap>

    <resultMap id="questioncard" type="storequestioncardvo">
        <id column="questionid" property="questionId"/>
        <result column="writername" property="writerName"/>
        <result column="content" property="content"/>
        <result column="replycreatedtime" property="replyCreatedTime"/>
        <association property="item" javaType="itemcardvo"/>
    </resultMap>

    <resultMap id="reviewcard" type="storereviewcardvo">
        <id column="reviewId" property="reviewId"/>
        <result column="writername" property="writerName"/>
        <result column="content" property="content"/>
        <result column="replycreatedtime" property="replyCreatedTime"/>
        <association property="item" javaType="itemcardvo"/>
    </resultMap>

    <resultMap id="tradecard" type="storetradecardvo">
        <id column="questionid" property="tradeId"/>
        <result column="buyername" property="buyerName"/>
        <result column="content" property="tradeStatus"/>
        <result column="requesttiem" property="requestTime"/>
        <result column="responsetime" property="requestTime"/>
        <association property="item" javaType="itemcardvo"/>
    </resultMap>

    <sql id="selectItem">
        select i.item_id       itemid,
               i.title         title,
               i.price         price,
               i.item_img_urls img,
               i.created_date  created,
               i.item_status   status
        from item i
    </sql>

    <sql id="sorting">
        order by i.
                ${sortKind}
                ${sortOrder}
                LIMIT
                ${startRow}
                ,
                ${countRow}
    </sql>


    <select id="selectStoreItemList" parameterType="storeitempagingdto" resultMap="itemcard">
        <include refid="selectItem"/>
        where user_id = #{userId}
        <include refid="sorting"/>
    </select>

    <select id="selectStoreFavoriteList">
        select * from (
        <include refid="selectItem"/>
        inner join favorite f
        on f.item_id = i.item_id
        where f.user_id = #{userId}
        <include refid="sorting"/>
    </select>

    <select id="selectStoreSoldItemList">
    </select>

    <select id="selectStoreQuestionList" parameterType="storeitempagingdto" resultMap="questioncard">
        select q.item_question_id,
        q.user_id writer,
        q.created_date,
        q.content,
        u.account_name,
        i.*
        from item_question q
        inner join (
        <include refid="selectItem"/>
        where user_id = #{userId}) i
        on itemid = q.item_id
        inner join users u
        on u.user_id = q.user_id
        <include refid="sorting"/>
    </select>


    <select id="selectStoreReviewList" parameterType="storeitempagingdto" resultMap="reviewcard">
        select *
        from store_review sr
        inner join (
        <include refid="selectItem"/>
        inner join purchase_item p
        on i.item_id = p.item_id
        where p.user_id = #{userId}) i
        on sr.purchase_item_id = i.p.purchase_item_id
        <include refid="sorting"/>
    </select>

    <select id="selectStoreTradeList" parameterType="storeitempagingdto" resultMap="tradecard">
        select t.trade_id,
        t.user_id,
        IF(t.response_create = t.request_create, t.response_create, t.request_create) createdDate,
        t.trade_status,
        i.*
        from trade t
        inner join (
        <include refid="selectItem"/>
        where user_id = #{userId}) i
        on itemid = t.item_id
        <include refid="sorting"/>
    </select>
</mapper>